<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LARP Blacklists</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.ico">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
        }
        .container-card {
            background-color: #21253d;
            border: 1px solid #333;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .input-field {
            background-color: #333b5c;
            border: 1px solid #4a5568;
            color: #ffffff;
        }
        .search-button {
            background-color: #e94560;
            transition: transform 0.2s ease-in-out;
        }
        .search-button:hover {
            transform: scale(1.05);
            background-color: #d1324a;
        }
        .copy-button {
            background-color: #4CAF50;
        }
        .copy-button:hover {
            background-color: #45a049;
        }
        .repo-button {
            background-color: #6B7280;
            transition: transform 0.2s ease-in-out;
        }
        .repo-button:hover {
            transform: scale(1.05);
            background-color: #4B5563;
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

<div id="app" class="w-full max-w-2xl mx-auto container-card rounded-lg p-8 space-y-8">
    <div class="text-center space-y-2">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500">
            LARP Blacklist
        </h1>
        <p class="text-lg text-gray-400">Search for a player to check their blacklist status.</p>
    </div>

    <form id="search-form" class="space-y-4">
        <input type="text" id="search-input" placeholder="Roblox User ID or Username, Discord User ID or Username" required
               class="w-full p-3 rounded-lg input-field placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button type="submit"
                class="w-full p-3 rounded-lg font-semibold text-white search-button">
            Search
        </button>

        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="https://github.com/Nickje2000/LARP" target="_blank"
               class="flex-1 text-center p-2 rounded-lg font-semibold text-white repo-button">
                View Repository
            </a>
            <button id="download-button"
                    class="flex-1 text-center p-2 rounded-lg font-semibold text-white repo-button">
                Download Blacklist JSON
            </button>
        </div>
    </form>

    <div id="status-message" class="text-center hidden">
        <div id="loading-spinner" class="animate-spin h-8 w-8 mx-auto hidden">
            <div class="rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"></div>
        </div>
        <p id="message-text" class="mt-4 text-sm text-gray-400"></p>
    </div>

    <div id="result-container" class="space-y-4 hidden">
        <h2 id="result-title" class="text-2xl font-bold text-center"></h2>
        <div id="result-details" class="container-card rounded-lg p-6 space-y-4">
            <p id="roblox-info" class="text-lg"></p>
            <p id="discord-info" class="text-lg"></p>
            <p id="reason-info" class="text-lg"></p>
            <p id="moderator-info" class="text-lg"></p>
        </div>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-4">
            <button id="copy-roblox" class="copy-button text-white p-2 rounded-lg font-semibold hidden">
                Copy Roblox ID
            </button>
            <button id="copy-discord" class="copy-button text-white p-2 rounded-lg font-semibold hidden">
                Copy Discord ID
            </button>
        </div>
    </div>

    <!-- Modal for Alerts -->
    <div id="alert-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-gray-800 rounded-lg p-6 shadow-xl space-y-4 w-11/12 max-w-md">
            <h3 id="alert-title" class="text-lg font-bold"></h3>
            <p id="alert-body" class="text-sm text-gray-300"></p>
            <div class="flex justify-end">
                <button id="alert-close" class="p-2 px-4 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/Nickje2000/LARP/refs/heads/main/blacklist.json';

    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const statusMessage = document.getElementById('status-message');
    const loadingSpinner = document.getElementById('loading-spinner');
    const messageText = document.getElementById('message-text');
    const resultContainer = document.getElementById('result-container');
    const resultTitle = document.getElementById('result-title');
    const resultDetails = document.getElementById('result-details');
    const robloxInfo = document.getElementById('roblox-info');
    const discordInfo = document.getElementById('discord-info');
    const reasonInfo = document.getElementById('reason-info');
    const moderatorInfo = document.getElementById('moderator-info');
    const copyRobloxButton = document.getElementById('copy-roblox');
    const copyDiscordButton = document.getElementById('copy-discord');
    const downloadButton = document.getElementById('download-button');
    const alertModal = document.getElementById('alert-modal');
    const alertTitle = document.getElementById('alert-title');
    const alertBody = document.getElementById('alert-body');
    const alertCloseButton = document.getElementById('alert-close');

    let blacklistData = [];

    async function fetchBlacklist() {
        try {
            showStatus('Fetching blacklist data...', true);
            const response = await fetch(GITHUB_RAW_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            blacklistData = data;
            showStatus('Blacklist data loaded.', false);
            return true;
        } catch (error) {
            console.error('Failed to fetch blacklist:', error);
            showStatus(`Failed to fetch blacklist: ${error.message}. Please contact staff.`, false);
            return false;
        }
    }

    function showStatus(message, showLoading) {
        statusMessage.classList.remove('hidden');
        messageText.textContent = message;
        if (showLoading) {
            loadingSpinner.classList.remove('hidden');
            messageText.classList.add('text-gray-400');
        } else {
            loadingSpinner.classList.add('hidden');
            messageText.classList.remove('text-gray-400');
        }
        resultContainer.classList.add('hidden');
    }

    function showAlert(title, message) {
        alertTitle.textContent = title;
        alertBody.textContent = message;
        alertModal.classList.remove('hidden');
    }

    function hideAlert() {
        alertModal.classList.add('hidden');
    }

    function searchBlacklist(query) {
        const normalizedQuery = query.trim().toLowerCase();
        return blacklistData.find(entry => {
            return (
                (entry.roblox_id && entry.roblox_id.toString().trim().toLowerCase() === normalizedQuery) ||
                (entry.roblox_username && entry.roblox_username.toString().trim().toLowerCase() === normalizedQuery) ||
                (entry.discord_id && entry.discord_id.toString().trim().toLowerCase() === normalizedQuery) ||
                (entry.discord_username && entry.discord_username.toString().trim().toLowerCase() === normalizedQuery)
            );
        });
    }

    function displayResult(result) {
        resultContainer.classList.remove('hidden');
        statusMessage.classList.add('hidden');
        resultDetails.classList.remove('bg-red-900', 'bg-green-900');
        copyRobloxButton.classList.add('hidden');
        copyDiscordButton.classList.add('hidden');

        if (result) {
            resultTitle.textContent = 'User is Blacklisted';
            resultTitle.classList.remove('text-green-500');
            resultTitle.classList.add('text-red-500');
            resultDetails.classList.add('bg-red-900');

            robloxInfo.innerHTML = `<strong>Roblox:</strong> ${result.roblox_username || 'N/A'} (ID: ${result.roblox_id || 'N/A'})`;
            discordInfo.innerHTML = `<strong>Discord:</strong> ${result.discord_username || 'N/A'} (ID: ${result.discord_id || 'N/A'})`;
            reasonInfo.innerHTML = `<strong>Reason:</strong> ${result.reason || 'N/A'}`;
            moderatorInfo.innerHTML = `<strong>Moderator:</strong> ${result.moderator || 'N/A'}`;

            if (result.roblox_id) {
                copyRobloxButton.classList.remove('hidden');
                copyRobloxButton.onclick = () => copyToClipboard(result.roblox_id, 'Roblox ID copied!');
            }
            if (result.discord_id) {
                copyDiscordButton.classList.remove('hidden');
                copyDiscordButton.onclick = () => copyToClipboard(result.discord_id, 'Discord ID copied!');
            }
        } else {
            resultTitle.textContent = 'User is Not Blacklisted';
            resultTitle.classList.remove('text-red-500');
            resultTitle.classList.add('text-green-500');
            resultDetails.classList.add('bg-green-900');

            robloxInfo.textContent = 'No blacklist entry found for the provided query.';
            discordInfo.textContent = '';
            reasonInfo.textContent = '';
            moderatorInfo.textContent = '';
        }
    }

    function copyToClipboard(text, successMessage) {
        const el = document.createElement('textarea');
        el.value = text;
        el.setAttribute('readonly', '');
        el.style.position = 'absolute';
        el.style.left = '-9999px';
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        showAlert('Success', successMessage);
    }

    function downloadJson() {
        if (blacklistData.length === 0) {
            showAlert('Download Error', 'Blacklist data not yet loaded. Please wait a moment and try again.');
            return;
        }

        const dataStr = JSON.stringify(blacklistData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'blacklist.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    searchForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = searchInput.value;
        if (query.length === 0) {
            showAlert('Input Error', 'Please enter a name or ID to search.');
            return;
        }

        if (blacklistData.length === 0) {
            const fetched = await fetchBlacklist();
            if (!fetched) {
                return;
            }
        }

        const result = searchBlacklist(query);
        displayResult(result);
    });

    downloadButton.addEventListener('click', downloadJson);
    alertCloseButton.addEventListener('click', hideAlert);

    window.onload = () => {
        fetchBlacklist();
    };

</script>
</body>
</html>
